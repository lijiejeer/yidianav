<!DOCTYPE html>
<html lang="zh-CN" id="top">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>网址导航 - 实用的资源导航综合网站</title>
    <link rel="shortcut icon" href="/web_tool-master/assets/images/favicon.png">
    <link rel="stylesheet" href="/web_tool-master/assets/css/block-library.min-5.6.2.css">
    <link rel="stylesheet" href="/web_tool-master/assets/css/iconfont-3.03029.1.css">
    <link rel="stylesheet" href="/web_tool-master/assets/css/bootstrap.min-4.3.1.css">
    <link rel="stylesheet" href="/web_tool-master/assets/css/fancybox.min-3.5.7.css">
    <link rel="stylesheet" href="/web_tool-master/assets/css/style-3.03029.1.css">
    <link rel="stylesheet" href="/web_tool-master/assets/css/custom-style.css">
    <link rel="stylesheet" href="/web_tool-master/assets/fontawesome-5.15.4/css/all.min.css">
    <style>
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }

        .sidebar-menu-inner ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 0;
        }

        .sidebar-menu-inner li.sidebar-item a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.85);
            transition: all .2s ease;
        }

        .sidebar-menu-inner li.sidebar-item a:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.08);
            text-decoration: none;
        }

        .sidebar-menu-inner li.sidebar-item a span[data-depth] {
            padding-left: var(--depth-padding, 0px);
            flex: 1;
        }

        #categoriesContainer section + section {
            margin-top: 3rem;
        }

        .section-heading {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 1.5rem;
        }

        .section-heading h4 {
            font-weight: 600;
            display: flex;
            align-items: center;
            color: #5f646d;
        }

        .section-heading h4 i {
            margin-right: 10px;
        }

        .url-card .url-img img {
            max-width: 40px;
            max-height: 40px;
            border-radius: 10px;
        }

        .url-card .url-img .fallback-icon {
            font-size: 24px;
            color: #6c63ff;
        }

        .search-info-text {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.75);
            margin-top: 10px;
        }

        .search-result-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .empty-state {
            padding: 80px 20px;
            text-align: center;
            color: #6c757d;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
        }

        .empty-state i {
            font-size: 32px;
            color: #6c63ff;
            margin-bottom: 12px;
        }

        .friendlink.card {
            border-radius: 20px;
            border: none;
            box-shadow: 0 15px 45px -20px rgba(92, 99, 244, 0.35);
        }

        .friendlink.card .card-body a {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 16px;
            background: rgba(92, 99, 244, 0.08);
            color: #4a4f5a;
            font-size: 13px;
            margin: 4px 6px;
            transition: all .2s ease;
        }

        .friendlink.card .card-body a:hover {
            background: rgba(92, 99, 244, 0.16);
            color: #5c63f4;
            text-decoration: none;
        }

        .notification-banner {
            margin-bottom: 1.5rem;
        }

        .notification-banner .alert {
            border-radius: 18px;
            box-shadow: 0 15px 35px -15px rgba(92, 99, 244, 0.45);
        }

        .floating-ad {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 120px;
            z-index: 1000;
        }

        .floating-ad.left {
            left: 20px;
        }

        .floating-ad.right {
            right: 20px;
        }

        .ad-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
            position: relative;
        }

        .ad-close {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 22px;
            height: 22px;
            border: none;
            border-radius: 50%;
            background: #ff5c5c;
            color: #fff;
            font-size: 12px;
            line-height: 1;
            cursor: pointer;
        }

        .ad-content img {
            width: 100%;
            border-radius: 8px;
        }

        @media (max-width: 1200px) {
            .floating-ad {
                display: none !important;
            }
        }

        @media (max-width: 991.98px) {
            .page-container {
                flex-direction: column;
            }

            #sidebar {
                width: 100% !important;
                position: relative;
            }
        }
    </style>
</head>
<body class="io-grey-mode">
    <div class="page-container">
        <div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px;">
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    <div class="logo overflow-hidden">
                        <a href="/" class="logo-expanded">
                            <img src="/web_tool-master/assets/images/bt8-expand-light.png" height="40" class="logo-light" alt="网址导航">
                            <img src="/web_tool-master/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none" alt="网址导航">
                        </a>
                        <a href="/" class="logo-collapsed">
                            <img src="/web_tool-master/assets/images/bt.png" height="40" class="logo-light" alt="网址导航">
                            <img src="/web_tool-master/assets/images/bt.png" height="40" class="logo-dark d-none" alt="网址导航">
                        </a>
                    </div>
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul id="sidebarMenu"></ul>
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
                            <li class="sidebar-item">
                                <a href="#friendLinksSection" class="smooth">
                                    <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                    <span>友情链接</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="/admin" target="_blank">
                                    <i class="fas fa-user-cog icon-fw icon-lg mr-2"></i>
                                    <span>管理后台</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-content flex-fill grid-bg">
            <div class="big-header-banner">
                <div id="header" class="page-header sticky">
                    <div class="navbar navbar-expand-md">
                        <div class="container-fluid p-0">
                            <a href="/" class="navbar-brand d-md-none" title="网址导航">
                                <img src="/web_tool-master/assets/images/bt.png" class="logo-light" alt="网址导航">
                                <img src="/web_tool-master/assets/images/bt.png" class="logo-dark d-none" alt="网址导航">
                            </a>
                            <div class="collapse navbar-collapse order-2 order-md-1">
                                <div class="header-mini-btn">
                                    <label>
                                        <input id="mini-button" type="checkbox">
                                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                            <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                            <path class="line--2" d="M0 50h80"></path>
                                            <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                        </svg>
                                    </label>
                                </div>
                                <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                                    <li>
                                        <a href="#top">
                                            <i class="fa fa-home fa-lg mr-2"></i>
                                            <span>首页</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#friendLinksSection">
                                            <i class="fa fa-book fa-lg mr-2"></i>
                                            <span>友情链接</span>
                                        </a>
                                    </li>
                                </ul>
                                <div class="weather d-none d-lg-flex align-items-center">
                                    <div id="he-plugin-simple"></div>
                                </div>
                            </div>
                            <ul class="nav navbar-menu text-xs order-1 order-md-2">
                                <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                                    <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">加载中...</a></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="placeholder" style="height:74px"></div>
            </div>

            <div class="header-big post-top css-color mb-4" id="search-bg">
                <div class="s-search">
                    <div id="search" class="s-search mx-auto">
                        <form id="searchForm" class="super-search-fm">
                            <input type="text" id="search-text" class="form-control smart-tips search-key" autocomplete="off" placeholder="输入关键字搜索">
                            <button class="submit" type="submit"><i class="iconfont icon-search"></i></button>
                        </form>
                        <div class="search-group group-a mt-3">
                            <ul class="search-type" id="searchEngineList">
                                <li>
                                    <input type="radio" name="search-engine" id="engine-baidu" value="https://www.baidu.com/s?wd=" data-placeholder="百度一下，你就知道" hidden checked>
                                    <label for="engine-baidu"><span class="text-muted">百度</span></label>
                                </li>
                                <li>
                                    <input type="radio" name="search-engine" id="engine-bing" value="https://cn.bing.com/search?q=" data-placeholder="微软 Bing 搜索" hidden>
                                    <label for="engine-bing"><span class="text-muted">必应</span></label>
                                </li>
                                <li>
                                    <input type="radio" name="search-engine" id="engine-google" value="https://www.google.com/search?q=" data-placeholder="谷歌搜索" hidden>
                                    <label for="engine-google"><span class="text-muted">谷歌</span></label>
                                </li>
                                <li>
                                    <input type="radio" name="search-engine" id="engine-github" value="https://github.com/search?q=" data-placeholder="GitHub 搜索" hidden>
                                    <label for="engine-github"><span class="text-muted">GitHub</span></label>
                                </li>
                                <li>
                                    <input type="radio" name="search-engine" id="engine-local" value="local" data-placeholder="站内导航搜索" hidden>
                                    <label for="engine-local"><span class="text-muted">站内</span></label>
                                </li>
                            </ul>
                            <div class="search-info-text">支持多引擎检索，选择“站内”可快速定位到本站收藏的资源。</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="content" class="content-site customize-site pb-5">
                <div id="notificationBanner" class="notification-banner"></div>
                <div id="categoriesContainer">
                    <div class="empty-state" id="categoriesLoading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div class="mt-2">正在加载导航内容，请稍候...</div>
                    </div>
                </div>
                <section id="friendLinksSection" class="mt-5">
                    <h4 class="text-gray text-lg mb-4">
                        <i class="iconfont icon-book-mark-line icon-lg mr-2"></i>友情链接
                    </h4>
                    <div class="friendlink text-xs card">
                        <div class="card-body d-flex flex-wrap" id="friendLinksContainer">
                            <span class="text-muted">正在加载友链...</span>
                        </div>
                    </div>
                </section>
                <footer class="main-footer footer-type-1 text-xs mt-5">
                    <div class="footer-inner">
                        <div class="footer-text text-center">
                            本站内容源自互联网，如有侵权请联系删除。<br>
                            &copy; 2024 网址导航 · 构建精选高效的上网入口
                        </div>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <div class="floating-ad left" id="leftAd" style="display: none;">
        <div class="ad-content">
            <button class="ad-close" onclick="closeAd('leftAd')">×</button>
            <div id="leftAdContent"></div>
        </div>
    </div>

    <div class="floating-ad right" id="rightAd" style="display: none;">
        <div class="ad-content">
            <button class="ad-close" onclick="closeAd('rightAd')">×</button>
            <div id="rightAdContent"></div>
        </div>
    </div>

    <script src="/web_tool-master/assets/js/jquery.min-3.2.1.js"></script>
    <script src="/web_tool-master/assets/js/popper.min.js"></script>
    <script src="/web_tool-master/assets/js/bootstrap.min-4.3.1.js"></script>
    <script>
        const API_BASE = '/api';
        let categoryCardsMap = new Map();
        let categoryNameMap = new Map();
        let availableCategories = [];
        let dataLoaded = false;
        let showingSearchResults = false;

        document.addEventListener('DOMContentLoaded', () => {
            initSearch();
            loadCategories(true);
            loadFriendLinks();
            loadAds();
            loadHitokoto();
        });

        function initSearch() {
            const searchInput = document.getElementById('search-text');
            const updatePlaceholder = () => {
                const checked = document.querySelector('input[name="search-engine"]:checked');
                if (checked && searchInput) {
                    const placeholder = checked.dataset.placeholder || '搜索你想要的内容';
                    searchInput.setAttribute('placeholder', placeholder);
                }
            };

            document.querySelectorAll('input[name="search-engine"]').forEach(radio => {
                radio.addEventListener('change', updatePlaceholder);
            });

            updatePlaceholder();

            const form = document.getElementById('searchForm');
            if (form) {
                form.addEventListener('submit', event => {
                    event.preventDefault();
                    performSearch();
                });
            }
        }

        function createEmptyState(message, iconClass = 'fas fa-info-circle') {
            const wrapper = document.createElement('div');
            wrapper.className = 'empty-state';
            wrapper.innerHTML = `
                <i class="${iconClass}"></i>
                <div class="mt-2">${message}</div>
            `;
            return wrapper;
        }

        function setCategoriesLoading() {
            const container = document.getElementById('categoriesContainer');
            if (!container) {
                return;
            }
            container.innerHTML = '';
            container.appendChild(createEmptyState('正在加载导航内容，请稍候...', 'fas fa-spinner fa-spin'));
        }

        function renderSidebar(categories) {
            const sidebarMenu = document.getElementById('sidebarMenu');
            if (!sidebarMenu) {
                return;
            }
            sidebarMenu.innerHTML = '';

            if (!categories.length) {
                const li = document.createElement('li');
                li.className = 'sidebar-item text-muted px-3 py-2';
                li.textContent = '暂无导航';
                sidebarMenu.appendChild(li);
                return;
            }

            categories.forEach(category => {
                const li = document.createElement('li');
                li.className = 'sidebar-item';

                const anchor = document.createElement('a');
                const anchorId = category.anchorId || `category-${category.id}`;
                anchor.href = `#${anchorId}`;
                anchor.className = 'smooth';

                const iconEl = document.createElement('i');
                const iconClass = category.icon && category.icon.trim().length ? category.icon : 'far fa-folder-open';
                iconEl.className = `${iconClass} icon-fw icon-lg mr-2`;
                anchor.appendChild(iconEl);

                const nameSpan = document.createElement('span');
                const depth = category.level || 0;
                const fullName = category.displayName || category.name || '';
                const label = depth && fullName.includes(' / ')
                    ? fullName.split(' / ').pop()
                    : fullName;

                nameSpan.dataset.depth = depth;
                nameSpan.textContent = label || '未命名分类';
                nameSpan.title = fullName || label || '未命名分类';
                nameSpan.style.setProperty('--depth-padding', `${depth * 16}px`);
                anchor.title = fullName || label || '未命名分类';
                anchor.appendChild(nameSpan);

                li.dataset.level = depth;
                li.dataset.anchor = anchorId;
                li.appendChild(anchor);
                sidebarMenu.appendChild(li);
            });
        }

        function createCardElement(card) {
            const col = document.createElement('div');
            col.className = 'url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a';

            const name = card.name && card.name.trim().length ? card.name.trim() : '未命名站点';
            const url = card.url && card.url.trim().length ? card.url.trim() : '#';
            const description = card.description && card.description.trim().length ? card.description.trim() : '暂无描述';

            const bodyWrapper = document.createElement('div');
            bodyWrapper.className = 'url-body default';

            const mainLink = document.createElement('a');
            mainLink.href = url;
            mainLink.target = url === '#' ? '_self' : '_blank';
            mainLink.rel = 'noopener noreferrer';
            mainLink.className = 'card no-c mb-4';
            mainLink.title = description;

            const cardBody = document.createElement('div');
            cardBody.className = 'card-body';

            const content = document.createElement('div');
            content.className = 'url-content d-flex align-items-center';

            const logoWrapper = document.createElement('div');
            logoWrapper.className = 'url-img mr-2 d-flex align-items-center justify-content-center';

            if (card.logo && card.logo.trim().length) {
                const logoImg = document.createElement('img');
                logoImg.src = card.logo.trim();
                logoImg.alt = name;
                logoImg.loading = 'lazy';
                logoImg.onerror = () => {
                    logoImg.onerror = null;
                    logoImg.src = '/web_tool-master/assets/images/logos/default.webp';
                };
                logoWrapper.appendChild(logoImg);
            } else {
                const fallbackIcon = document.createElement('i');
                fallbackIcon.className = 'fas fa-globe-asia fallback-icon';
                logoWrapper.appendChild(fallbackIcon);
            }

            const infoWrapper = document.createElement('div');
            infoWrapper.className = 'url-info flex-fill';

            const nameEl = document.createElement('div');
            nameEl.className = 'text-sm overflowClip_1';
            const strong = document.createElement('strong');
            strong.textContent = name;
            nameEl.appendChild(strong);

            const descEl = document.createElement('p');
            descEl.className = 'overflowClip_1 m-0 text-muted text-xs';
            descEl.textContent = description;

            infoWrapper.appendChild(nameEl);
            infoWrapper.appendChild(descEl);

            content.appendChild(logoWrapper);
            content.appendChild(infoWrapper);
            cardBody.appendChild(content);
            mainLink.appendChild(cardBody);

            const togoLink = document.createElement('a');
            togoLink.href = url;
            togoLink.target = url === '#' ? '_self' : '_blank';
            togoLink.rel = 'noopener noreferrer nofollow';
            togoLink.className = 'togo text-center text-muted is-views';
            togoLink.title = `直达 ${name}`;
            togoLink.setAttribute('aria-label', `直达 ${name}`);
            const togoIcon = document.createElement('i');
            togoIcon.className = 'iconfont icon-goto';
            togoLink.appendChild(togoIcon);

            bodyWrapper.appendChild(mainLink);
            bodyWrapper.appendChild(togoLink);
            col.appendChild(bodyWrapper);

            return col;
        }

        function createCategorySection(category, cards) {
            const anchorId = category.anchorId || `category-${category.id}`;
            const section = document.createElement('section');
            section.id = anchorId;
            section.className = 'io-card mb-5 category-section';
            section.dataset.level = category.level || 0;

            const heading = document.createElement('div');
            heading.className = 'section-heading d-flex align-items-center justify-content-between flex-wrap';

            const title = document.createElement('h4');
            title.className = 'text-gray text-lg mb-4 d-flex align-items-center';

            const iconEl = document.createElement('i');
            const iconClass = category.icon && category.icon.trim().length ? category.icon.trim() : 'iconfont icon-tag';
            iconEl.className = `site-tag icon-lg mr-2 ${iconClass}`;
            iconEl.id = `${anchorId}-icon`;
            title.appendChild(iconEl);

            const titleText = document.createElement('span');
            const headingText = category.level && category.displayName
                ? category.displayName.split(' / ').pop()
                : (category.displayName || category.name);
            titleText.textContent = headingText || '未命名分类';
            titleText.title = category.displayName || headingText || '未命名分类';
            title.appendChild(titleText);

            heading.appendChild(title);
            section.appendChild(heading);

            const row = document.createElement('div');
            row.className = 'row row-md';
            cards.forEach(card => row.appendChild(createCardElement(card)));
            section.appendChild(row);

            return section;
        }

        function renderCategories(categories) {
            const container = document.getElementById('categoriesContainer');
            if (!container) {
                return;
            }
            container.innerHTML = '';

            const sections = categories
                .map(category => {
                    const cards = categoryCardsMap.get(category.id) || [];
                    if (!cards.length) {
                        return null;
                    }
                    return createCategorySection(category, cards);
                })
                .filter(Boolean);

            if (!sections.length) {
                container.appendChild(createEmptyState('当前暂无可展示的导航内容，请稍后再试。'));
                return;
            }

            sections.forEach(section => container.appendChild(section));
        }

        async function fetchCardsByCategory(categoryId) {
            try {
                const response = await fetch(`${API_BASE}/public/cards/category/${categoryId}`);
                const result = await response.json();
                if (result.success && Array.isArray(result.data)) {
                    return result.data;
                }
            } catch (error) {
                console.error(error);
            }
            return [];
        }

        function flattenCategories(categories, level = 0, path = []) {
            const result = [];
            categories.forEach(category => {
                const normalizedName = typeof category.name === 'string' && category.name.trim().length
                    ? category.name.trim()
                    : '未命名分类';
                const currentPath = [...path, normalizedName];
                const anchorId = category.anchorId && category.anchorId.trim().length
                    ? category.anchorId.trim()
                    : `category-${category.id}`;

                if (!category.anchorId || !category.anchorId.trim().length) {
                    category.anchorId = anchorId;
                }

                const item = {
                    id: category.id,
                    name: normalizedName,
                    displayName: currentPath.join(' / '),
                    icon: category.icon,
                    level,
                    parentId: category.parentId,
                    anchorId,
                    path: currentPath
                };
                result.push(item);
                if (category.children && category.children.length) {
                    result.push(...flattenCategories(category.children, level + 1, currentPath));
                }
            });
            return result;
        }

        async function loadCategories(force = false) {
            if (!force && dataLoaded && !showingSearchResults) {
                renderSidebar(availableCategories);
                renderCategories(availableCategories);
                return;
            }

            setCategoriesLoading();

            try {
                const response = await fetch(`${API_BASE}/public/categories`);
                const result = await response.json();

                if (!result.success) {
                    renderCategories([]);
                    showNotification(result.message || '加载栏目失败，请稍后重试。', 'danger');
                    return;
                }

                const flattened = flattenCategories(Array.isArray(result.data) ? result.data : []);

                categoryCardsMap = new Map();
                categoryNameMap = new Map();

                const promises = flattened.map(async category => {
                    categoryNameMap.set(category.id, category.displayName || category.name);
                    const cards = await fetchCardsByCategory(category.id);
                    categoryCardsMap.set(category.id, cards);
                });

                await Promise.all(promises);

                availableCategories = flattened.filter(category => {
                    const cards = categoryCardsMap.get(category.id) || [];
                    return cards.length > 0;
                });

                dataLoaded = true;
                showingSearchResults = false;

                renderSidebar(availableCategories);
                renderCategories(availableCategories);
            } catch (error) {
                console.error(error);
                renderCategories([]);
                showNotification('加载导航数据时出现异常，请检查网络后重试。', 'danger');
            }
        }

        function displaySearchResults(results) {
            showingSearchResults = true;
            const container = document.getElementById('categoriesContainer');
            if (!container) {
                return;
            }
            container.innerHTML = '';

            const section = document.createElement('section');
            section.id = 'search-results';
            section.className = 'io-card mb-5 category-section';

            const heading = document.createElement('div');
            heading.className = 'section-heading d-flex align-items-center justify-content-between flex-wrap';

            const title = document.createElement('h4');
            title.className = 'text-gray text-lg mb-4 d-flex align-items-center';
            const iconEl = document.createElement('i');
            iconEl.className = 'site-tag icon-lg mr-2 fas fa-search';
            iconEl.id = 'search-results-icon';
            title.appendChild(iconEl);
            title.appendChild(document.createTextNode('搜索结果'));
            heading.appendChild(title);

            const actions = document.createElement('div');
            actions.className = 'search-result-actions mb-3';
            const backBtn = document.createElement('button');
            backBtn.type = 'button';
            backBtn.className = 'btn btn-sm btn-outline-secondary';
            backBtn.textContent = '返回全部导航';
            backBtn.addEventListener('click', () => {
                showingSearchResults = false;
                renderSidebar(availableCategories);
                renderCategories(availableCategories);
            });
            actions.appendChild(backBtn);
            heading.appendChild(actions);

            section.appendChild(heading);

            if (!results.length) {
                section.appendChild(createEmptyState('没有找到匹配的站点，换个关键词试试吧。', 'fas fa-search-minus'));
                container.appendChild(section);
                renderSidebar([
                    {
                        id: 'search-results',
                        anchorId: 'search-results',
                        displayName: '搜索结果',
                        icon: 'fas fa-search',
                        level: 0
                    }
                ]);
                return;
            }

            const grouped = new Map();
            results.forEach(card => {
                const categoryId = card.categoryId;
                const groupTitleText = categoryNameMap.get(categoryId) || '未分类';
                if (!grouped.has(categoryId)) {
                    grouped.set(categoryId, { title: groupTitleText, cards: [] });
                }
                grouped.get(categoryId).cards.push(card);
            });

            grouped.forEach(value => {
                const groupSection = document.createElement('div');
                groupSection.className = 'mb-4';

                const groupTitle = document.createElement('h5');
                groupTitle.className = 'text-muted mb-3 d-flex align-items-center';
                const folderIcon = document.createElement('i');
                folderIcon.className = 'far fa-folder-open mr-2';
                groupTitle.appendChild(folderIcon);
                groupTitle.appendChild(document.createTextNode(value.title));
                groupSection.appendChild(groupTitle);

                const row = document.createElement('div');
                row.className = 'row row-md';
                value.cards.forEach(card => row.appendChild(createCardElement(card)));
                groupSection.appendChild(row);

                section.appendChild(groupSection);
            });

            container.appendChild(section);
            renderSidebar([
                {
                    id: 'search-results',
                    anchorId: 'search-results',
                    displayName: '搜索结果',
                    icon: 'fas fa-search',
                    level: 0
                }
            ]);
        }

        async function loadFriendLinks() {
            const container = document.getElementById('friendLinksContainer');
            if (!container) {
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/public/friendlinks`);
                const result = await response.json();
                container.innerHTML = '';

                if (result.success && Array.isArray(result.data) && result.data.length) {
                    const links = [...result.data].sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));
                    links.forEach(link => {
                        const anchor = document.createElement('a');
                        anchor.href = link.url;
                        anchor.target = '_blank';
                        anchor.rel = 'noopener noreferrer';
                        anchor.title = link.description || link.name;
                        anchor.textContent = link.name;
                        container.appendChild(anchor);
                    });
                } else {
                    container.innerHTML = '<span class="text-muted">暂无友链内容。</span>';
                }
            } catch (error) {
                console.error(error);
                container.innerHTML = '<span class="text-muted">友链加载失败。</span>';
            }
        }

        function loadAds() {
            fetch(`${API_BASE}/public/ads/left`)
                .then(response => response.json())
                .then(result => {
                    if (result.success && Array.isArray(result.data) && result.data.length) {
                        const ad = result.data[0];
                        const content = document.getElementById('leftAdContent');
                        if (content) {
                            content.innerHTML = `
                                <a href="${ad.linkUrl}" target="_blank" rel="noopener noreferrer">
                                    <img src="${ad.imageUrl}" alt="${ad.title}">
                                </a>
                            `;
                            const wrapper = document.getElementById('leftAd');
                            if (wrapper) {
                                wrapper.style.display = 'block';
                            }
                        }
                    }
                })
                .catch(() => {});

            fetch(`${API_BASE}/public/ads/right`)
                .then(response => response.json())
                .then(result => {
                    if (result.success && Array.isArray(result.data) && result.data.length) {
                        const ad = result.data[0];
                        const content = document.getElementById('rightAdContent');
                        if (content) {
                            content.innerHTML = `
                                <a href="${ad.linkUrl}" target="_blank" rel="noopener noreferrer">
                                    <img src="${ad.imageUrl}" alt="${ad.title}">
                                </a>
                            `;
                            const wrapper = document.getElementById('rightAd');
                            if (wrapper) {
                                wrapper.style.display = 'block';
                            }
                        }
                    }
                })
                .catch(() => {});
        }

        function closeAd(adId) {
            const element = document.getElementById(adId);
            if (element) {
                element.style.display = 'none';
            }
        }

        function loadHitokoto() {
            fetch('https://v1.hitokoto.cn')
                .then(response => response.json())
                .then(data => {
                    const anchor = document.getElementById('hitokoto_text');
                    if (anchor && data && data.hitokoto) {
                        if (data.uuid) {
                            anchor.href = `https://hitokoto.cn/?uuid=${data.uuid}`;
                        }
                        anchor.textContent = data.hitokoto;
                    }
                })
                .catch(() => {
                    const anchor = document.getElementById('hitokoto_text');
                    if (anchor) {
                        anchor.textContent = '欢迎来到网址导航';
                        anchor.removeAttribute('href');
                    }
                });
        }

        async function performSearch() {
            const searchInput = document.getElementById('search-text');
            if (!searchInput) {
                return;
            }
            const query = searchInput.value.trim();
            if (!query) {
                showNotification('请输入搜索关键词。', 'warning');
                searchInput.focus();
                return;
            }

            const checked = document.querySelector('input[name="search-engine"]:checked');
            if (!checked) {
                return;
            }

            if (checked.value === 'local') {
                try {
                    const response = await fetch(`${API_BASE}/public/cards/search?keyword=${encodeURIComponent(query)}`);
                    const result = await response.json();
                    if (result.success) {
                        displaySearchResults(Array.isArray(result.data) ? result.data : []);
                    } else {
                        showNotification(result.message || '搜索失败，请稍后再试。', 'danger');
                    }
                } catch (error) {
                    console.error(error);
                    showNotification('站内搜索失败，请检查网络后再试。', 'danger');
                }
            } else {
                window.open(`${checked.value}${encodeURIComponent(query)}`, '_blank');
            }
        }

        function showNotification(message, type = 'info', timeout = 4000) {
            const banner = document.getElementById('notificationBanner');
            if (!banner) {
                return;
            }

            banner.innerHTML = '';
            if (!message) {
                return;
            }

            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.setAttribute('role', 'alert');
            alert.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="关闭">
                    <span aria-hidden="true">&times;</span>
                </button>
            `;
            banner.appendChild(alert);

            if (timeout) {
                setTimeout(() => {
                    if (window.jQuery && $(alert).length) {
                        $(alert).alert('close');
                    } else if (alert && alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, timeout);
            }
        }

        window.closeAd = closeAd;
    </script>
    <script>
        window.WIDGET = {
            CONFIG: {
                modules: '01234',
                background: 5,
                tmpColor: 'E4C600',
                tmpSize: 14,
                cityColor: 'E4C600',
                citySize: 14,
                aqiColor: '#E4C600',
                aqiSize: 14,
                weatherIconSize: 28,
                alertIconSize: 18,
                padding: '10px 10px 10px 10px',
                shadow: '1',
                language: 'auto',
                borderRadius: 5,
                fixed: 'false',
                vertical: 'middle',
                horizontal: 'left',
                key: '085791e805a24491b43b06cf58ab31e7'
            }
        };
    </script>
    <script src="/web_tool-master/assets/js/weather-widget.js"></script>
</body>
</html>
